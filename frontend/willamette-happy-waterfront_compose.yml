willamette_data:
  image: smartercleanup/flavors-data:release-0.6.1
  volumes:
    - /$WILLAMETTE_FLAVOR
  environment:
    - FLAVOR=${WILLAMETTE_FLAVOR}
    - SITE_KEY=${WILLAMETTE_KEY}
    - SITE_URL=${WILLAMETTE_URL}
  command: sh -c "git fetch && git checkout master && git pull --rebase && /duwamish/start-data-container.sh"

willamette:
  image: smartercleanup/flavors:release-0.6.1
  ports:
    - "${WILLAMETTE_PORT}:${WILLAMETTE_PORT}"
  environment:
    - DEBUG=${DEBUG}
    - PORT=${WILLAMETTE_PORT}
    - FLAVOR=${WILLAMETTE_FLAVOR}
    - SITE_KEY=${WILLAMETTE_KEY}
    - SITE_URL=${WILLAMETTE_URL}
    - CLICKY_ANALYTICS_ID=${DUWAMISH_CLICKY_ANALYTICS_ID}
    # - MAPBOX_TOKEN=${MAPBOX_TOKEN}
  restart: always
  command: sh -c "git fetch && git checkout master && git pull --rebase && /duwamish/start.sh"

happytrail_data:
  image: smartercleanup/flavors-data
  volumes:
    - /$HAPPYTRAIL_FLAVOR
  environment:
    - FLAVOR=$HAPPYTRAIL_FLAVOR
    - SITE_KEY=${DUWAMISH_KEY}
    - SITE_URL=${DUWAMISH_URL}

happytrail:
  image: smartercleanup/flavors
  ports:
    - "${HAPPYTRAIL_PORT}:${HAPPYTRAIL_PORT}"
  environment:
    - DEBUG=${DEBUG}
    - PORT=${HAPPYTRAIL_PORT}
    - FLAVOR=${HAPPYTRAIL_FLAVOR}
    - SITE_KEY=${DUWAMISH_KEY}
    - SITE_URL=${DUWAMISH_URL}
    - CLICKY_ANALYTICS_ID=${DUWAMISH_CLICKY_ANALYTICS_ID}
    # - MAPBOX_TOKEN=${MAPBOX_TOKEN}
  restart: always

trees_data:
  image: smartercleanup/flavors-data
  volumes:
    - /${TREES_FLAVOR}
  environment:
    - FLAVOR=${TREES_FLAVOR}
    - SITE_KEY=${TREES_KEY}
    - SITE_URL=${TREES_URL}

trees:
  image: smartercleanup/flavors
  ports:
    - "${TREES_PORT}:${TREES_PORT}"
  environment:
    - DEBUG=${DEBUG}
    - PORT=${TREES_PORT}
    - FLAVOR=${TREES_FLAVOR}
    - SITE_KEY=${TREES_KEY}
    - SITE_URL=${TREES_URL}
    - CLICKY_ANALYTICS_ID=${TREES_CLICKY_ANALYTICS_ID}
    # - MAPBOX_TOKEN=${MAPBOX_TOKEN}
  restart: always

nginx_flavors:
  image: smartercleanup/flavors-nginx
  links:
    - "${WILLAMETTE_FLAVOR}"
    - "${HAPPYTRAIL_FLAVOR}"
    - "${TREES_FLAVOR}"
  volumes_from:
    - "${WILLAMETTE_FLAVOR}_data"
    - "${HAPPYTRAIL_FLAVOR}_data"
    - "${TREES_FLAVOR}_data"
  ports:
    - "80:80"
  volumes:
    - "./willamette-happy-trees_nginx.conf:/nginx.conf"
  restart: always
